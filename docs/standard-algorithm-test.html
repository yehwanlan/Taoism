<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨™æº–æ¼”ç®—æ³•é©—è­‰</title>
    <style>
        body { 
            font-family: 'Microsoft JhengHei', sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result { 
            background: #f8f9fa; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #6c757d;
        }
        .success { 
            background: #d4edda; 
            border-left-color: #28a745; 
            color: #155724;
        }
        .error { 
            background: #f8d7da; 
            border-left-color: #dc3545; 
            color: #721c24;
        }
        .info { 
            background: #d1ecf1; 
            border-left-color: #17a2b8; 
            color: #0c5460;
        }
        .formula {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .highlight {
            background: #fff3cd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§® æ¨™æº–æ¼”ç®—æ³•é©—è­‰</h1>
        
        <div class="info">
            <h3>ğŸ“‹ æ¨™æº–æ¼”ç®—æ³•èªªæ˜</h3>
            <div class="formula">
                <strong>æ­¥é©Ÿ1:</strong> è¨ˆç®—å„’ç•¥æ—¥æ•¸ (JDN)<br>
                <strong>æ­¥é©Ÿ2:</strong> å¤©å¹²ç´¢å¼• = (JDN + 9) % 10<br>
                <strong>æ­¥é©Ÿ3:</strong> åœ°æ”¯ç´¢å¼• = (JDN + 1) % 12<br>
                <strong>æ­¥é©Ÿ4:</strong> çµ„åˆæˆæ—¥å¹²æ”¯
            </div>
            <p><strong>å¤©å¹²è¡¨:</strong> [ç”², ä¹™, ä¸™, ä¸, æˆŠ, å·±, åºš, è¾›, å£¬, ç™¸]</p>
            <p><strong>åœ°æ”¯è¡¨:</strong> [å­, ä¸‘, å¯…, å¯, è¾°, å·³, åˆ, æœª, ç”³, é…‰, æˆŒ, äº¥]</p>
        </div>

        <div id="verification-results"></div>
        
        <h3>ğŸ“Š è©³ç´°è¨ˆç®—éç¨‹</h3>
        <div id="calculation-details"></div>
    </div>

    <script src="js/fortune.js"></script>
    <script>
        // æ¨™æº–æ¼”ç®—æ³•å¯¦ä½œ
        function standardAlgorithm(year, month, day) {
            // è¨ˆç®—å„’ç•¥æ—¥æ•¸
            let a = Math.floor((14 - month) / 12);
            let y = year + 4800 - a;
            let m = month + 12 * a - 3;
            
            let jdn = day + Math.floor((153 * m + 2) / 5) + 365 * y + 
                      Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
            
            // æ¨™æº–å…¬å¼
            const stemIndex = (jdn + 9) % 10;
            const branchIndex = (jdn + 1) % 12;
            
            const stems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
            const branches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
            
            return {
                jdn: jdn,
                stemIndex: stemIndex,
                branchIndex: branchIndex,
                stem: stems[stemIndex],
                branch: branches[branchIndex],
                stemBranch: stems[stemIndex] + branches[branchIndex]
            };
        }
        
        // æ¸¬è©¦æ•¸æ“š
        const testCases = [
            { year: 2000, month: 1, day: 1, expected: 'æˆŠåˆ', note: 'åŸºæº–æ—¥æœŸ' },
            { year: 2025, month: 1, day: 9, expected: 'æˆŠå¯…', note: 'ä»Šå¤©' },
            { year: 2025, month: 1, day: 10, expected: 'å·±å¯', note: 'æ˜å¤©' }
        ];
        
        let verificationHtml = '<h3>ğŸ¯ é—œéµæ—¥æœŸé©—è­‰</h3>';
        let detailsHtml = '';
        
        testCases.forEach((testCase, index) => {
            const result = standardAlgorithm(testCase.year, testCase.month, testCase.day);
            const classResult = fortuneChecker.getStemBranch(new Date(testCase.year, testCase.month - 1, testCase.day), false);
            
            const isExpectedCorrect = result.stemBranch === testCase.expected;
            const isClassCorrect = classResult === testCase.expected;
            const isConsistent = result.stemBranch === classResult;
            
            const statusClass = isExpectedCorrect && isClassCorrect && isConsistent ? 'success' : 'error';
            
            verificationHtml += `
                <div class="${statusClass}">
                    <h4>${testCase.note} - ${testCase.year}å¹´${testCase.month}æœˆ${testCase.day}æ—¥</h4>
                    <p><strong>é æœŸçµæœ:</strong> ${testCase.expected}</p>
                    <p><strong>æ¨™æº–æ¼”ç®—æ³•:</strong> ${result.stemBranch} ${isExpectedCorrect ? 'âœ…' : 'âŒ'}</p>
                    <p><strong>é¡æ–¹æ³•çµæœ:</strong> ${classResult} ${isClassCorrect ? 'âœ…' : 'âŒ'}</p>
                    <p><strong>ä¸€è‡´æ€§:</strong> ${isConsistent ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}</p>
                </div>
            `;
            
            detailsHtml += `
                <div class="result">
                    <h4>${testCase.year}å¹´${testCase.month}æœˆ${testCase.day}æ—¥ è©³ç´°è¨ˆç®—</h4>
                    <table>
                        <tr><th>é …ç›®</th><th>æ•¸å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å„’ç•¥æ—¥æ•¸ (JDN)</td><td class="highlight">${result.jdn}</td><td>æ ¼é‡Œé«˜åˆ©æ›†è½‰æ›çµæœ</td></tr>
                        <tr><td>å¤©å¹²è¨ˆç®—</td><td>(${result.jdn} + 9) % 10 = ${result.stemIndex}</td><td>${result.stem}</td></tr>
                        <tr><td>åœ°æ”¯è¨ˆç®—</td><td>(${result.jdn} + 1) % 12 = ${result.branchIndex}</td><td>${result.branch}</td></tr>
                        <tr><td class="highlight">æœ€çµ‚çµæœ</td><td class="highlight">${result.stemBranch}</td><td>æ—¥å¹²æ”¯</td></tr>
                    </table>
                </div>
            `;
        });
        
        document.getElementById('verification-results').innerHTML = verificationHtml;
        document.getElementById('calculation-details').innerHTML = detailsHtml;
        
        // åœ¨æ§åˆ¶å°è¼¸å‡ºé©—è­‰çµæœ
        console.log('=== æ¨™æº–æ¼”ç®—æ³•é©—è­‰çµæœ ===');
        testCases.forEach(testCase => {
            const result = standardAlgorithm(testCase.year, testCase.month, testCase.day);
            console.log(`${testCase.year}-${testCase.month}-${testCase.day}: ${result.stemBranch} (JDN=${result.jdn})`);
        });
        
        // é©—è­‰é¡æ–¹æ³•
        console.log('\n=== é¡æ–¹æ³•é©—è­‰ ===');
        fortuneChecker.validateStemBranch();
    </script>
</body>
</html>