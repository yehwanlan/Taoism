<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¹²æ”¯è¨ˆç®—èª¿è©¦</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f2f2f2;
        }
        .highlight {
            background: #fff3cd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æ—¥å¹²æ”¯è¨ˆç®—èª¿è©¦å·¥å…·</h1>
    
    <div class="debug-section">
        <h3>ğŸ“… æ¸¬è©¦ä»Šå¤©çš„è¨ˆç®—</h3>
        <div id="today-debug"></div>
    </div>
    
    <div class="debug-section">
        <h3>ğŸ§® åŸºæº–æ—¥æœŸé©—è­‰</h3>
        <div id="base-debug"></div>
    </div>
    
    <div class="debug-section">
        <h3>ğŸ“Š é€£çºŒæ—¥æœŸæ¸¬è©¦</h3>
        <div id="sequence-debug"></div>
    </div>
    
    <div class="debug-section">
        <h3>ğŸ”„ æ‰‹å‹•è¨ˆç®—å°æ¯”</h3>
        <input type="date" id="manual-date" value="2025-01-09">
        <button onclick="manualCalculate()">è¨ˆç®—</button>
        <div id="manual-result"></div>
    </div>

    <script src="js/fortune.js"></script>
    <script>
        // æ‰‹å‹•å¯¦ç¾å„’ç•¥æ—¥æ•¸è¨ˆç®—ï¼ˆç”¨æ–¼å°æ¯”ï¼‰
        function calculateJDN(year, month, day) {
            let a = Math.floor((14 - month) / 12);
            let y = year + 4800 - a;
            let m = month + 12 * a - 3;
            
            return day + Math.floor((153 * m + 2) / 5) + 365 * y + 
                   Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
        }
        
        // ç°¡åŒ–çš„æ—¥å¹²æ”¯è¨ˆç®—ï¼ˆä¸ä½¿ç”¨é¡æ–¹æ³•ï¼‰
        function simpleStemBranch(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            const jdn = calculateJDN(year, month, day);
            const baseJDN = 2451545; // 2000å¹´1æœˆ1æ—¥
            const daysDiff = jdn - baseJDN;
            
            // ç”²è¾°æ˜¯ç¬¬40å€‹ï¼ˆå¾0é–‹å§‹ï¼‰
            let index = (40 + daysDiff) % 60;
            if (index < 0) index += 60;
            
            const stems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
            const branches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
            
            return {
                stemBranch: stems[index % 10] + branches[index % 12],
                index: index,
                jdn: jdn,
                daysDiff: daysDiff
            };
        }
        
        // æ¸¬è©¦ä»Šå¤©
        function debugToday() {
            const today = new Date();
            const todayStr = today.toLocaleDateString('zh-TW');
            
            // ä½¿ç”¨é¡æ–¹æ³•è¨ˆç®—
            const classResult = fortuneChecker.getStemBranch(today, false); // ä¸ä½¿ç”¨å‚³çµ±æ™‚é–“
            const classInfo = fortuneChecker.getCalculationInfo(today);
            
            // ä½¿ç”¨ç°¡åŒ–æ–¹æ³•è¨ˆç®—
            const simpleResult = simpleStemBranch(today);
            
            document.getElementById('today-debug').innerHTML = `
                <h4>ä»Šå¤©: ${todayStr}</h4>
                <table>
                    <tr><th>æ–¹æ³•</th><th>çµæœ</th><th>ç´¢å¼•</th><th>å„’ç•¥æ—¥æ•¸</th><th>å¤©æ•¸å·®</th></tr>
                    <tr class="${classResult === simpleResult.stemBranch ? 'success' : 'error'}">
                        <td>é¡æ–¹æ³•</td>
                        <td>${classResult}</td>
                        <td>${classInfo.stemBranchIndex}</td>
                        <td>${classInfo.targetJDN}</td>
                        <td>${classInfo.daysDiff}</td>
                    </tr>
                    <tr>
                        <td>ç°¡åŒ–æ–¹æ³•</td>
                        <td>${simpleResult.stemBranch}</td>
                        <td>${simpleResult.index}</td>
                        <td>${simpleResult.jdn}</td>
                        <td>${simpleResult.daysDiff}</td>
                    </tr>
                </table>
                <p><strong>çµæœä¸€è‡´:</strong> ${classResult === simpleResult.stemBranch ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>
            `;
        }
        
        // é©—è­‰åŸºæº–æ—¥æœŸ
        function debugBase() {
            const baseDate = new Date(2000, 0, 1); // 2000å¹´1æœˆ1æ—¥
            const baseDateStr = baseDate.toLocaleDateString('zh-TW');
            
            const classResult = fortuneChecker.getStemBranch(baseDate, false);
            const simpleResult = simpleStemBranch(baseDate);
            
            // æª¢æŸ¥å„’ç•¥æ—¥æ•¸
            const expectedJDN = 2451545;
            const calculatedJDN = calculateJDN(2000, 1, 1);
            
            document.getElementById('base-debug').innerHTML = `
                <h4>åŸºæº–æ—¥æœŸ: ${baseDateStr} (æ‡‰è©²æ˜¯ç”²è¾°æ—¥)</h4>
                <table>
                    <tr><th>é …ç›®</th><th>é æœŸå€¼</th><th>è¨ˆç®—å€¼</th><th>æ­£ç¢º</th></tr>
                    <tr class="${expectedJDN === calculatedJDN ? 'success' : 'error'}">
                        <td>å„’ç•¥æ—¥æ•¸</td>
                        <td>${expectedJDN}</td>
                        <td>${calculatedJDN}</td>
                        <td>${expectedJDN === calculatedJDN ? 'âœ…' : 'âŒ'}</td>
                    </tr>
                    <tr class="${classResult === 'ç”²è¾°' ? 'success' : 'error'}">
                        <td>é¡æ–¹æ³•çµæœ</td>
                        <td>ç”²è¾°</td>
                        <td>${classResult}</td>
                        <td>${classResult === 'ç”²è¾°' ? 'âœ…' : 'âŒ'}</td>
                    </tr>
                    <tr class="${simpleResult.stemBranch === 'ç”²è¾°' ? 'success' : 'error'}">
                        <td>ç°¡åŒ–æ–¹æ³•çµæœ</td>
                        <td>ç”²è¾°</td>
                        <td>${simpleResult.stemBranch}</td>
                        <td>${simpleResult.stemBranch === 'ç”²è¾°' ? 'âœ…' : 'âŒ'}</td>
                    </tr>
                </table>
            `;
        }
        
        // æ¸¬è©¦é€£çºŒæ—¥æœŸ
        function debugSequence() {
            const baseDate = new Date(2025, 0, 9); // 2025å¹´1æœˆ9æ—¥
            let html = '<h4>é€£çºŒæ—¥æœŸæ¸¬è©¦ (å¾2025å¹´1æœˆ9æ—¥é–‹å§‹)</h4><table>';
            html += '<tr><th>æ—¥æœŸ</th><th>é¡æ–¹æ³•</th><th>ç°¡åŒ–æ–¹æ³•</th><th>ä¸€è‡´</th></tr>';
            
            for (let i = 0; i < 5; i++) {
                const testDate = new Date(baseDate);
                testDate.setDate(baseDate.getDate() + i);
                
                const classResult = fortuneChecker.getStemBranch(testDate, false);
                const simpleResult = simpleStemBranch(testDate);
                const isMatch = classResult === simpleResult.stemBranch;
                
                html += `<tr class="${isMatch ? 'success' : 'error'}">
                    <td>${testDate.toLocaleDateString('zh-TW')}</td>
                    <td>${classResult}</td>
                    <td>${simpleResult.stemBranch}</td>
                    <td>${isMatch ? 'âœ…' : 'âŒ'}</td>
                </tr>`;
            }
            
            html += '</table>';
            document.getElementById('sequence-debug').innerHTML = html;
        }
        
        // æ‰‹å‹•è¨ˆç®—
        function manualCalculate() {
            const dateInput = document.getElementById('manual-date').value;
            if (!dateInput) return;
            
            const date = new Date(dateInput);
            const classResult = fortuneChecker.getStemBranch(date, false);
            const classInfo = fortuneChecker.getCalculationInfo(date);
            const simpleResult = simpleStemBranch(date);
            
            // è©³ç´°è¨ˆç®—æ­¥é©Ÿ
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            document.getElementById('manual-result').innerHTML = `
                <h4>è©³ç´°è¨ˆç®—: ${dateInput}</h4>
                <p><strong>æ­¥é©Ÿ1:</strong> å¹´=${year}, æœˆ=${month}, æ—¥=${day}</p>
                <p><strong>æ­¥é©Ÿ2:</strong> å„’ç•¥æ—¥æ•¸ = ${simpleResult.jdn}</p>
                <p><strong>æ­¥é©Ÿ3:</strong> å¤©æ•¸å·® = ${simpleResult.jdn} - 2414686 = ${simpleResult.daysDiff}</p>
                <p><strong>æ­¥é©Ÿ4:</strong> ç´¢å¼• = (36 + ${simpleResult.daysDiff}) % 60 = ${simpleResult.index}</p>
                <p><strong>æ­¥é©Ÿ5:</strong> å¤©å¹²ç´¢å¼• = ${simpleResult.index} % 10 = ${simpleResult.index % 10}</p>
                <p><strong>æ­¥é©Ÿ6:</strong> åœ°æ”¯ç´¢å¼• = ${simpleResult.index} % 12 = ${simpleResult.index % 12}</p>
                <p><strong>çµæœ:</strong> ${simpleResult.stemBranch}</p>
                
                <table style="margin-top: 15px;">
                    <tr><th>æ–¹æ³•</th><th>çµæœ</th><th>ä¸€è‡´</th></tr>
                    <tr class="${classResult === simpleResult.stemBranch ? 'success' : 'error'}">
                        <td>é¡æ–¹æ³•</td>
                        <td>${classResult}</td>
                        <td rowspan="2">${classResult === simpleResult.stemBranch ? 'âœ…' : 'âŒ'}</td>
                    </tr>
                    <tr>
                        <td>æ‰‹å‹•è¨ˆç®—</td>
                        <td>${simpleResult.stemBranch}</td>
                    </tr>
                </table>
            `;
        }
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        document.addEventListener('DOMContentLoaded', () => {
            debugToday();
            debugBase();
            debugSequence();
        });
    </script>
</body>
</html>