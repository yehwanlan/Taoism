# 🔧 環境設定指南

道教經典翻譯系統 v2.0 的完整環境設定說明

## 🚀 快速開始

### 1. 系統需求
- **Python**: 3.7 或更高版本
- **作業系統**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **記憶體**: 建議 4GB 以上
- **硬碟空間**: 建議 1GB 以上

### 2. 環境準備

#### 方法A: 使用虛擬環境（推薦）
```bash
# 1. 克隆專案
git clone https://github.com/your-repo/taoism-translation.git
cd taoism-translation

# 2. 建立虛擬環境
python -m venv venv

# 3. 啟動虛擬環境
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 4. 安裝依賴
pip install -r requirements.txt

# 5. 複製配置檔案
cp config/settings.example.json config/settings.json
```

#### 方法B: 直接安裝（不推薦）
```bash
# 1. 克隆專案
git clone https://github.com/your-repo/taoism-translation.git
cd taoism-translation

# 2. 直接安裝依賴
pip install -r requirements.txt

# 3. 複製配置檔案
cp config/settings.example.json config/settings.json
```

## ⚙️ 配置設定

### 1. 基本配置
編輯 `config/settings.json`：

```json
{
  "translation": {
    "base_url": "https://www.shidianguji.com",
    "request_delay": 2,
    "max_retries": 3,
    "timeout": 10
  },
  "output": {
    "source_dir": "docs/source_texts",
    "translation_dir": "docs/translations"
  }
}
```

### 2. 進階配置（可選）

#### API 金鑰設定
如果要使用 AI 翻譯功能：

```json
{
  "api": {
    "openai_api_key": "sk-your-openai-key-here",
    "gemini_api_key": "your-gemini-key-here",
    "enable_ai_translation": true
  }
}
```

#### 安全設定
```json
{
  "security": {
    "rate_limit": {
      "requests_per_minute": 30,
      "requests_per_hour": 1000
    }
  }
}
```

### 3. 環境變數（可選）
建立 `.env` 檔案：

```bash
# API 金鑰
OPENAI_API_KEY=sk-your-openai-key-here
GEMINI_API_KEY=your-gemini-key-here

# 資料庫設定（如果使用）
DATABASE_URL=sqlite:///data/database.db

# 除錯模式
DEBUG=false
LOG_LEVEL=INFO
```

## 🧪 驗證安裝

### 1. 基本功能測試
```bash
# 檢查系統資訊
python main.py info

# 檢查依賴套件
python -c "import requests, bs4; print('✅ 依賴套件正常')"

# 檢查配置檔案
python -c "import json; json.load(open('config/settings.json')); print('✅ 配置檔案正常')"
```

### 2. 功能測試
```bash
# 測試監控功能
python main.py monitor status

# 測試翻譯功能（使用測試URL）
python main.py translate --book "https://www.shidianguji.com/book/DZ0047"

# 測試網頁功能
python -m http.server 8000 --directory docs
# 然後訪問 http://localhost:8000
```

## 🔍 常見問題

### 1. Python 版本問題
```bash
# 檢查 Python 版本
python --version

# 如果版本過舊，請升級
# Windows: 從 python.org 下載最新版本
# macOS: brew install python3
# Ubuntu: sudo apt update && sudo apt install python3.9
```

### 2. 依賴套件安裝失敗
```bash
# 升級 pip
python -m pip install --upgrade pip

# 清除快取重新安裝
pip cache purge
pip install -r requirements.txt --no-cache-dir

# 如果仍有問題，逐一安裝
pip install requests beautifulsoup4 pathlib
```

### 3. 權限問題
```bash
# Windows: 以管理員身分執行命令提示字元
# macOS/Linux: 使用 sudo（不推薦）或調整檔案權限
chmod +x main.py
```

### 4. 網路連接問題
```bash
# 測試網路連接
python -c "import requests; print(requests.get('https://www.shidianguji.com').status_code)"

# 如果使用代理，設定環境變數
export HTTP_PROXY=http://proxy.example.com:8080
export HTTPS_PROXY=https://proxy.example.com:8080
```

## 🐳 Docker 部署（進階）

### 1. 建立 Dockerfile
```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "main.py", "translate", "--interactive"]
```

### 2. 建立 docker-compose.yml
```yaml
version: '3.8'

services:
  taoism-translator:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
      - ./docs:/app/docs
      - ./config:/app/config
    environment:
      - PYTHONUNBUFFERED=1
```

### 3. 執行
```bash
# 建立並啟動
docker-compose up -d

# 檢查狀態
docker-compose ps

# 查看日誌
docker-compose logs -f
```

## 🔧 開發環境設定

### 1. 開發依賴
```bash
# 安裝開發依賴
pip install pytest pytest-cov black flake8 mypy

# 或者建立 requirements-dev.txt
pip install -r requirements-dev.txt
```

### 2. 程式碼品質工具
```bash
# 程式碼格式化
black .

# 程式碼檢查
flake8 .

# 類型檢查
mypy .

# 執行測試
pytest tests/ -v --cov=.
```

### 3. Git 設定
```bash
# 設定 Git hooks（可選）
cp .githooks/pre-commit .git/hooks/
chmod +x .git/hooks/pre-commit

# 設定 Git 忽略
# .gitignore 檔案已包含常見的忽略項目
```

## 📊 效能優化

### 1. 系統優化
```bash
# 增加檔案描述符限制（Linux/macOS）
ulimit -n 4096

# 設定 Python 優化
export PYTHONOPTIMIZE=1
```

### 2. 記憶體優化
```python
# 在 config/settings.json 中調整
{
  "file_monitor": {
    "max_operations": 500  # 減少記憶體使用
  },
  "tracking": {
    "max_log_entries": 500
  }
}
```

### 3. 網路優化
```python
# 調整請求參數
{
  "translation": {
    "request_delay": 1,    # 減少延遲（小心被封鎖）
    "timeout": 15,         # 增加超時時間
    "max_retries": 5       # 增加重試次數
  }
}
```

## 🔒 安全設定

### 1. API 金鑰管理
```bash
# 使用環境變數而非配置檔案
export OPENAI_API_KEY="your-key-here"

# 或使用 .env 檔案（記得加入 .gitignore）
echo "OPENAI_API_KEY=your-key-here" >> .env
```

### 2. 檔案權限
```bash
# 設定敏感檔案權限
chmod 600 config/settings.json
chmod 600 .env

# 設定目錄權限
chmod 755 data/
chmod 755 docs/
```

### 3. 網路安全
```python
# 在配置中啟用安全選項
{
  "security": {
    "verify_ssl": true,
    "use_secure_headers": true,
    "rate_limit": {
      "enabled": true,
      "requests_per_minute": 30
    }
  }
}
```

## 📞 技術支援

### 獲取幫助
1. 查看文檔：`docs/system/` 目錄
2. 檢查 GitHub Issues
3. 查看系統日誌：`data/logs/`
4. 使用除錯模式：`DEBUG=true python main.py`

### 回報問題
請提供以下資訊：
- 作業系統和版本
- Python 版本
- 錯誤訊息和堆疊追蹤
- 配置檔案（移除敏感資訊）
- 重現步驟

---

*環境設定指南 - 道教經典翻譯系統 v2.0* 🔧✨