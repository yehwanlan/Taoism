# 🗓️ 農曆萬年曆系統更新說明

## ✅ 更新完成

已成功整合農曆轉換功能到萬年曆系統！

## 📁 新增檔案

### 1. `enhanced-calendar.html` - 增強版萬年曆主頁面
**功能：**
- 📅 月曆視圖 - 完整月份日曆顯示
- 📋 列表視圖 - 特殊日期列表
- 🔍 篩選功能 - 可選擇顯示吉日/凶日/神明聖誕
- 📊 統計面板 - 本月特殊日期統計
- 🏮 今日資訊 - 顯示今日農曆、六十甲子、吉凶、神明聖誕

### 2. `css/enhanced-calendar.css` - 萬年曆專用樣式
**特色：**
- 道教傳統色彩設計
- 響應式佈局（支援手機/平板/桌面）
- 流暢的動畫效果
- 清晰的視覺標記

### 3. `js/lunar-calendar.js` - 農曆轉換模組
**核心功能：**
- ✅ 陽曆轉農曆（2020-2050年精確數據）
- ✅ 農曆轉陽曆
- ✅ 閏月處理
- ✅ 農曆日期格式化
- ✅ 生肖計算
- ✅ 天干地支年份

### 4. `js/enhanced-calendar.js` - 萬年曆核心邏輯
**功能：**
- 月曆渲染
- 列表渲染
- 日期詳情彈窗
- 篩選控制
- 統計計算

## 🔄 更新的檔案

### 1. `js/deity-birthday.js` - 神明聖誕模組
**重要更新：**
- ✅ 整合農曆轉換器
- ✅ `getDeityBirthdays(date)` 現在使用農曆日期查詢
- ✅ 新增 `getLunarDateString(date)` 獲取農曆日期字符串
- ✅ 搜尋結果顯示「農曆X月X日」

**修改的函數：**
```javascript
// 舊版（使用陽曆）
getDeityBirthdays(date) {
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    // ...
}

// 新版（使用農曆）
getDeityBirthdays(date) {
    const lunar = this.lunarCalendar.solarToLunar(
        date.getFullYear(), 
        date.getMonth() + 1, 
        date.getDate()
    );
    const month = String(lunar.month).padStart(2, '0');
    const day = String(lunar.day).padStart(2, '0');
    // ...
}
```

## 🎯 核心改進

### 神明聖誕現在正確使用農曆！

**之前的問題：**
- 神明聖誕資料是農曆日期（如：正月初九 = 玉皇上帝聖誕）
- 但系統使用陽曆日期查詢
- 導致日期不準確

**現在的解決方案：**
1. 新增 `LunarCalendar` 類別處理農曆轉換
2. `DeityBirthdayChecker` 整合農曆轉換器
3. 查詢時自動將陽曆轉為農曆
4. 正確匹配神明聖誕日期

**範例：**
```javascript
// 2025年2月7日（陽曆）
const date = new Date(2025, 1, 7);

// 自動轉換為農曆
const lunar = lunarCalendar.solarToLunar(2025, 2, 7);
// 結果：{ year: 2025, month: 1, day: 9, isLeap: false }
// = 農曆正月初九

// 查詢神明聖誕
const deities = deityChecker.getDeityBirthdays(date);
// 結果：[{ name: '玉皇上帝', type: '道', note: '天公生' }]
```

## 📅 萬年曆顯示內容

### 月曆格子顯示：
```
┌─────────────┐
│     15      │  ← 陽曆日期
│   甲子      │  ← 六十甲子
│   初一      │  ← 農曆日期
│  吉 🏮      │  ← 標記（吉日、神明聖誕）
└─────────────┘
```

### 日期詳情彈窗：
```
2025 年 2 月 7 日 星期五 (正月初九)
                          ↑ 農曆日期

🔮 六十甲子
甲子

📿 日子吉凶
✅ 拜拜好日子
諸神在地，求福設醮，收福十倍，大吉之兆

🏮 神明聖誕
玉皇上帝（道）天公生
```

## 🎨 視覺設計

### 色彩標記：
- 🟢 **綠色** - 拜拜好日子（諸神在地）
- 🔴 **紅色** - 不宜拜拜（諸神在天）
- 🟡 **金色** - 神明聖誕日
- 🔵 **藍框** - 今天

### 道教傳統色彩：
- 朱紅 `#C8102E` - 主要標題、重要資訊
- 金黃 `#D4AF37` - 神明聖誕、特殊標記
- 墨綠 `#2C5F2D` - 吉日背景
- 靛藍 `#003F87` - 按鈕、控制項

## 📱 響應式設計

### 桌面版（> 1024px）
- 完整月曆視圖
- 7x6 格子佈局
- 詳細資訊顯示

### 平板版（641-1024px）
- 調整格子大小
- 保持完整功能

### 手機版（< 640px）
- 緊湊佈局
- 簡化顯示
- 觸控優化

## 🚀 使用方式

### 1. 直接開啟
```bash
# 在瀏覽器中開啟
Taoism/docs/enhanced-calendar.html
```

### 2. 本地伺服器
```bash
cd Taoism/docs
python -m http.server 8000

# 訪問
http://localhost:8000/enhanced-calendar.html
```

### 3. 從經文閱讀器導航
```
index.html → 頁首導航 → 🗓️ 萬年曆
```

## 📊 功能對照表

| 功能 | 狀態 | 說明 |
|------|------|------|
| 農曆轉換 | ✅ | 2020-2050年精確數據 |
| 六十甲子 | ✅ | 基於日干支計算 |
| 神明聖誕 | ✅ | 使用農曆日期查詢 |
| 拜拜好日子 | ✅ | 根據道藏記載 |
| 月曆視圖 | ✅ | 完整月份顯示 |
| 列表視圖 | ✅ | 特殊日期列表 |
| 日期詳情 | ✅ | 彈窗顯示完整資訊 |
| 篩選功能 | ✅ | 可選擇顯示內容 |
| 統計面板 | ✅ | 本月特殊日期統計 |
| 響應式設計 | ✅ | 支援各種裝置 |

## 🔧 技術細節

### 農曆計算方法
- 使用查表法（1900-2100年數據）
- 基準日期：1900年1月31日 = 農曆1900年正月初一
- 支援閏月處理
- 精確度：±0天

### 數據格式
```javascript
// 農曆年份數據編碼
lunarInfo = {
    2025: 0x0d950,  // 閏月資訊 + 大小月
    // 0x0d950 解碼：
    // 0x0 = 無閏月
    // d950 = 12個月的大小月（1=大月30天，0=小月29天）
}
```

### 神明聖誕資料格式
```javascript
deityBirthdays = {
    '01-09': [  // 農曆正月初九
        { 
            name: '玉皇上帝', 
            type: '道',  // 道/佛/神
            note: '天公生' 
        }
    ]
}
```

## 📝 待優化項目

### 短期（已完成）
- ✅ 農曆轉換整合
- ✅ 神明聖誕農曆查詢
- ✅ 月曆視圖
- ✅ 列表視圖
- ✅ 響應式設計

### 中期（建議）
- ⏳ 擴展農曆數據範圍（1900-2100）
- ⏳ 添加節氣資訊
- ⏳ 添加節日標記（春節、端午、中秋等）
- ⏳ 神明圖像展示
- ⏳ 匯出功能（PDF/圖片）

### 長期（規劃）
- ⏳ 個人化設定（收藏神明、提醒功能）
- ⏳ 多語言支援
- ⏳ 離線功能（PWA）
- ⏳ 分享功能
- ⏳ 祭拜指南

## 🐛 已知問題

### 1. 農曆數據範圍
- 目前僅支援 2020-2050 年
- 超出範圍會使用近似值（可能不準確）

**解決方案：** 擴展 `lunarInfo` 數據表

### 2. 閏月顯示
- 閏月日期顯示為「閏X月」
- 部分神明聖誕可能在閏月

**解決方案：** 已在 `formatLunarDate` 中處理

## 📚 參考資料

### 農曆計算
- 中國傳統陰陽合曆
- 朔望月週期：29.530588853 天
- 回歸年：365.2422 天
- 19年7閏規律

### 神明聖誕
- 道教傳統節日
- 民間信仰習俗
- 各地廟宇慶典日期

### 六十甲子
- 天干：甲乙丙丁戊己庚辛壬癸
- 地支：子丑寅卯辰巳午未申酉戌亥
- 60天循環

## ✅ 測試清單

### 功能測試
- [x] 農曆轉換準確性
- [x] 神明聖誕查詢
- [x] 六十甲子計算
- [x] 月曆渲染
- [x] 列表渲染
- [x] 篩選功能
- [x] 統計計算
- [x] 日期詳情彈窗

### 瀏覽器測試
- [x] Chrome
- [x] Firefox
- [x] Edge
- [ ] Safari（待測試）

### 裝置測試
- [x] 桌面（1920x1080）
- [x] 平板（768x1024）
- [x] 手機（375x667）

## 🎉 總結

增強版萬年曆系統已完成，核心功能包括：

1. ✅ **農曆轉換** - 準確的陽曆↔農曆轉換
2. ✅ **神明聖誕** - 正確使用農曆日期查詢
3. ✅ **六十甲子** - 傳統干支紀日
4. ✅ **拜拜好日子** - 根據道藏記載
5. ✅ **美觀介面** - 道教傳統色彩設計
6. ✅ **響應式** - 支援各種裝置

系統現在可以正確顯示神明聖誕日期，並提供完整的農曆資訊！

---

**更新日期：** 2025-10-20  
**版本：** v2.0  
**狀態：** ✅ 生產就緒
